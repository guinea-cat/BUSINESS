"""æŠ¥å‘Šä¼˜åŒ–æ¨¡å— - ä½¿ç”¨DeepSeekæ¨¡å‹ä¼˜åŒ–æŠ¥å‘Šè¾“å‡º

é€šè¿‡å¤§è¯­è¨€æ¨¡å‹å°†ç»“æ„åŒ–è¯„ä¼°æ•°æ®è½¬åŒ–ä¸ºäººæ€§åŒ–ã€æ˜“è¯»çš„æŠ¥å‘Šæ–‡æœ¬ã€‚
"""
import os
import sys
from pathlib import Path
from typing import Dict, Any, Optional
import json
from datetime import datetime

sys.path.append(str(Path(__file__).parent.parent))
from config import DEEPSEEK_API_BASE, DEEPSEEK_API_KEY, DEEPSEEK_MODEL


class ReportOptimizer:
    """æŠ¥å‘Šä¼˜åŒ–å™¨ - ä½¿ç”¨DeepSeekæ¨¡å‹ç”Ÿæˆäººæ€§åŒ–æŠ¥å‘Š"""
    
    SYSTEM_PROMPT = """ä½ æ˜¯ä¸€ä½èµ„æ·±çš„AIåº”ç”¨è¯„å®¡ä¸“å®¶å’ŒæŠ€æœ¯åˆ†æå¸ˆï¼Œè´Ÿè´£å°†é¡¹ç›®è¯„ä¼°æ•°æ®è½¬åŒ–ä¸º**æå…¶è¯¦å°½ã€æ·±å…¥ã€ä¸“ä¸š**çš„è¯„å®¡æŠ¥å‘Šã€‚

## æ ¸å¿ƒè¦æ±‚
1. **æ·±åº¦æ€è€ƒæ¨¡å¼**ï¼šåœ¨ç”ŸæˆæŠ¥å‘Šå‰ï¼Œå…ˆå¯¹é¡¹ç›®è¿›è¡Œæ·±åº¦æ€è€ƒï¼Œåˆ†æå…¶æœ¬è´¨ã€åˆ›æ–°ç‚¹å’Œæ½œåœ¨ä»·å€¼
2. **å»æ¨¡æ¿åŒ–**ï¼šæ‘†è„±å›ºå®šæ ¼å¼çš„é™åˆ¶ï¼Œæ ¹æ®é¡¹ç›®ç‰¹ç‚¹è‡ªç”±ç»„ç»‡å†…å®¹ç»“æ„ï¼Œçªå‡ºé¡¹ç›®çš„ç‹¬ç‰¹æ€§
3. **æ·±åº¦åˆ†æ**ï¼šæ¯ä¸ªç»´åº¦åˆ†æå¿…é¡»**å……åˆ†å±•å¼€**ï¼ŒåŒ…å«ï¼š
   - ç°çŠ¶è¯¦ç»†æè¿°ï¼ˆå…·ä½“æŠ€æœ¯/ç‰¹æ€§ï¼‰
   - ä¼˜ç‚¹åˆ†æï¼ˆ2-3ä¸ªå…·ä½“ä¼˜ç‚¹ï¼Œè¦æœ‰æ•°æ®æˆ–äº‹å®æ”¯æŒï¼‰
   - ä¸è¶³åˆ†æï¼ˆ1-2ä¸ªå…·ä½“ä¸è¶³ï¼Œè¦åˆ‡ä¸­è¦å®³ï¼‰
   - ä¸åŒç±»é¡¹ç›®çš„æ·±åº¦å¯¹æ¯”
   - å…·ä½“å¯è¡Œçš„æ”¹è¿›æ–¹å‘å»ºè®®
4. **é’ˆå¯¹æ€§**ï¼šæŠ¥å‘Šå†…å®¹å¿…é¡»ç´§å¯†ç»“åˆé¡¹ç›®æœ¬èº«çš„ç‰¹ç‚¹ï¼Œé¿å…æ³›æ³›è€Œè°ˆï¼Œè¦æœ‰å…·ä½“çš„é¡¹ç›®ç»†èŠ‚å’Œæ¡ˆä¾‹
5. **AIå¹»è§‰é˜²æŠ¤**ï¼šåŸºäºäº‹å®å’Œæ•°æ®è¿›è¡Œåˆ†æï¼Œé¿å…äº§ç”ŸAIå¹»è§‰ï¼Œå¯¹äºä¸ç¡®å®šçš„ä¿¡æ¯è¦æ˜ç¡®æ ‡æ³¨

## æŠ¥å‘Šé£æ ¼
- è¯­è¨€ä¸“ä¸šä¸¥è°¨ï¼Œä½†æ˜“äºç†è§£
- è¯„ä»·å®¢è§‚å…¬æ­£ï¼Œå¼•ç”¨å…·ä½“æ•°æ®å’Œäº‹å®
- åˆ†æè¦**æ·±å…¥é€å½»**ï¼Œä¸èƒ½æµäºè¡¨é¢
- å»ºè®®è¦**å…·ä½“å¯æ“ä½œ**ï¼Œæœ‰æ˜ç¡®çš„å®æ–½è·¯å¾„
- çªå‡ºé¡¹ç›®çš„å®é™…ä»·å€¼å’Œç¤¾ä¼šå½±å“
- ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘è¿è´¯ï¼Œå±‚å±‚é€’è¿›

## å†…å®¹è¦æ±‚
- **é¡¹ç›®æœ¬è´¨åˆ†æ**ï¼šæ·±å…¥ç†è§£é¡¹ç›®çš„æ ¸å¿ƒä»·å€¼å’Œåˆ›æ–°æœ¬è´¨
- **æŠ€æœ¯æ·±åº¦åˆ†æ**ï¼šåˆ†ææŠ€æœ¯å®ç°çš„åˆ›æ–°ç‚¹å’ŒæŠ€æœ¯é€‰å‹çš„åˆç†æ€§
- **åœºæ™¯æ·±åº¦åˆ†æ**ï¼šåˆ†æåº”ç”¨åœºæ™¯çš„åˆ›æ–°æ€§å’Œç¤¾ä¼šä»·å€¼
- **å¸‚åœºæ·±åº¦åˆ†æ**ï¼šåˆ†æå¸‚åœºå®šä½å’Œç«äº‰ä¼˜åŠ¿
- **é£é™©æ·±åº¦åˆ†æ**ï¼šåˆ†æé¡¹ç›®é¢ä¸´çš„æŠ€æœ¯å’Œå•†ä¸šé£é™©
- **å‘å±•æ½œåŠ›åˆ†æ**ï¼šåˆ†æé¡¹ç›®çš„é•¿æœŸå‘å±•æ½œåŠ›å’Œæ‰©å±•ç©ºé—´

## æ ¼å¼å»ºè®®
- ä½¿ç”¨Markdownæ ¼å¼ï¼Œä½†ä¸è¦æ‹˜æ³¥äºå›ºå®šæ¨¡æ¿
- å–„ç”¨è¡¨æ ¼ã€åˆ—è¡¨ç­‰å½¢å¼å¢å¼ºå¯è¯»æ€§
- æ¯ä¸ªç« èŠ‚éƒ½è¦æœ‰å®è´¨å†…å®¹ï¼Œç¦æ­¢ç©ºæ³›æè¿°
- æ ¹æ®é¡¹ç›®ç‰¹ç‚¹çµæ´»ç»„ç»‡å†…å®¹ç»“æ„"""

    def __init__(self, api_base: str = None, api_key: str = None, model: str = None):
        """åˆå§‹åŒ–æŠ¥å‘Šä¼˜åŒ–å™¨
        
        Args:
            api_base: OpenAIå…¼å®¹APIçš„base URL
            api_key: APIå¯†é’¥
            model: æ¨¡å‹åç§°
        """
        self.api_base = api_base or DEEPSEEK_API_BASE
        self.api_key = api_key or DEEPSEEK_API_KEY
        self.model = model or DEEPSEEK_MODEL
        self.client = None
        self._init_client()
    
    def _init_client(self):
        """åˆå§‹åŒ–OpenAIå®¢æˆ·ç«¯"""
        try:
            from openai import OpenAI
            self.client = OpenAI(
                base_url=self.api_base,
                api_key=self.api_key,
            )
        except ImportError:
            print("Warning: openai package not installed, report optimization disabled")
            self.client = None
        except Exception as e:
            print(f"Warning: Failed to init OpenAI client: {e}")
            self.client = None
    
    def optimize_report(self, report_data: Dict[str, Any], prompt_data: Optional[Dict[str, Any]] = None, 
                        system_prompt: Optional[str] = None, user_prompt: Optional[str] = None,
                        timeout: int = 300) -> Optional[str]:
        """ä¼˜åŒ–æŠ¥å‘Šè¾“å‡º
        
        Args:
            report_data: è¯„ä¼°æŠ¥å‘Šçš„ç»“æ„åŒ–æ•°æ®
            prompt_data: æç¤ºè¯æ•°æ®ï¼ŒåŒ…å«é¢„æ„å»ºçš„æç¤ºè¯å†…å®¹
            system_prompt: å¯é€‰çš„ç³»ç»Ÿæç¤ºè¯ï¼ˆç”±PromptEngineeringLibraryç”Ÿæˆï¼‰
            user_prompt: å¯é€‰çš„ç”¨æˆ·æç¤ºè¯ï¼ˆç”±PromptEngineeringLibraryç”Ÿæˆï¼‰
            timeout: è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
            
        Returns:
            ä¼˜åŒ–åçš„MarkdownæŠ¥å‘Šï¼Œå¤±è´¥è¿”å›None
        """
        if not self.client:
            return None
        
        # ä¼˜å…ˆä½¿ç”¨ä¼ å…¥çš„æç¤ºè¯ï¼Œå¦åˆ™æ„å»ºé»˜è®¤æç¤ºè¯
        final_system_prompt = system_prompt or self.SYSTEM_PROMPT
        final_user_prompt = user_prompt or self._build_prompt(report_data, prompt_data)
        
        try:
            # æ·±åº¦æ€è€ƒæ¨¡å¼ï¼šä½¿ç”¨æ›´ä½çš„æ¸©åº¦ï¼Œè®©æ¨¡å‹æ›´åŠ ç†æ€§å’Œæ·±å…¥
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": final_system_prompt},
                    {"role": "user", "content": final_user_prompt}
                ],
                temperature=0.3,  # é™ä½æ¸©åº¦ï¼Œæé«˜æ€è€ƒæ·±åº¦å’Œä¸€è‡´æ€§
                max_tokens=16384,
                timeout=timeout,
                top_p=0.9,  # æ§åˆ¶ç”Ÿæˆçš„å¤šæ ·æ€§
                frequency_penalty=0.1,  # å‡å°‘é‡å¤å†…å®¹
                presence_penalty=0.1,  # é¼“åŠ±æ–°å†…å®¹
            )
            
            # å¤„ç†æ¨¡å‹è¾“å‡ºï¼Œæ·»åŠ AIå¹»è§‰é˜²æŠ¤æç¤º
            output = response.choices[0].message.content
            return self._add_ai_hallucination_warning(output)
        except Exception as e:
            print(f"Report optimization failed: {e}")
            return None
    
    def _build_prompt(self, data: Dict[str, Any], prompt_data: Optional[Dict[str, Any]] = None) -> str:
        """æ„å»ºä¼˜åŒ–æç¤ºè¯"""
        
        # å¦‚æœæä¾›äº†æç¤ºè¯æ•°æ®ï¼Œä½¿ç”¨å®ƒ
        if prompt_data:
            return f"""# é¡¹ç›®è¯„ä¼°æ•°æ®

## åŸºæœ¬ä¿¡æ¯
| å±æ€§ | å€¼ |
|------|------|
| é¡¹ç›®åç§° | {prompt_data.get('repo_name', 'Unknown')} |
| é¡¹ç›®æè¿° | {prompt_data.get('description', 'æ— æè¿°')} |
| ä¸»è¦è¯­è¨€ | {prompt_data.get('language', 'Unknown')} |
| GitHub Staræ•° | {prompt_data.get('stars', 0):,} |
| é¡¹ç›®URL | {prompt_data.get('repo_url', '')} |

## è¯„ä¼°å¾—åˆ†æ¦‚è§ˆ
| æŒ‡æ ‡ | å¾—åˆ† | æ»¡åˆ† |
|------|------|------|
| **æ€»åˆ†** | **{prompt_data.get('total_score', 0):.1f}** | 100 |
| åˆ›æ–°ç­‰çº§ | {prompt_data.get('level', 'æœªçŸ¥')} {prompt_data.get('level_stars', '')} | - |
| æŠ€æœ¯åˆ›æ–°åŠ› | {prompt_data.get('tech_innovation_score', 0):.1f} | 40 |
| åœºæ™¯åˆ›æ–°åŠ› | {prompt_data.get('scenario_innovation_score', 0):.1f} | 60 |

## å…­ç»´åº¦è¯¦ç»†å¾—åˆ†
{prompt_data.get('dim_table', '')}

## é›·è¾¾å›¾åˆ†æ
{prompt_data.get('radar_analysis', 'æ— åˆ†æ')}

## å„ç»´åº¦è¯¦ç»†åˆ†ææ•°æ®
{prompt_data.get('analyses_text', '')}

## ç°æœ‰æ”¹è¿›å»ºè®®
### æŠ€æœ¯åŠ å›º
{prompt_data.get('tech_suggestions', 'æ— ')}

### åœºæ™¯æ·±åŒ–  
{prompt_data.get('scenario_suggestions', 'æ— ')}

### äº§å“åŒ–æ¨è¿›
{prompt_data.get('product_suggestions', 'æ— ')}

## è¯„å§”å…³æ³¨ç‚¹
{prompt_data.get('judge_focus_points', 'æ— ')}

---

# æŠ¥å‘Šç”Ÿæˆè¦æ±‚

**é‡è¦ï¼šä½ å¿…é¡»ç”Ÿæˆä¸€ä»½æå…¶è¯¦ç»†ã€ä¸“ä¸šçš„è¯„å®¡æŠ¥å‘Šï¼Œæ€»å­—æ•°ä¸å°‘äº4000å­—ï¼**

## æ·±åº¦æ€è€ƒè¦æ±‚
åœ¨ç”ŸæˆæŠ¥å‘Šå‰ï¼Œè¯·å…ˆè¿›è¡Œæ·±åº¦æ€è€ƒï¼š
1. è¿™ä¸ªé¡¹ç›®çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿå®ƒçœŸæ­£è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
2. é¡¹ç›®çš„æ ¸å¿ƒåˆ›æ–°ç‚¹åœ¨å“ªé‡Œï¼Ÿä¸åŒç±»é¡¹ç›®æœ‰ä½•ä¸åŒï¼Ÿ
3. é¡¹ç›®çš„æŠ€æœ¯å®ç°æœ‰å“ªäº›ç‹¬ç‰¹ä¹‹å¤„ï¼ŸæŠ€æœ¯é€‰å‹æ˜¯å¦åˆç†ï¼Ÿ
4. é¡¹ç›®çš„åº”ç”¨åœºæ™¯æ˜¯å¦æœ‰æ·±åº¦ï¼Ÿæ˜¯å¦æœåŠ¡äºç‰¹å®šçš„é«˜ä»·å€¼äººç¾¤ï¼Ÿ
5. é¡¹ç›®çš„å¸‚åœºå®šä½æ˜¯å¦æ¸…æ™°ï¼Ÿå•†ä¸šåŒ–æ½œåŠ›å¦‚ä½•ï¼Ÿ
6. é¡¹ç›®é¢ä¸´çš„ä¸»è¦é£é™©å’ŒæŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ
7. é¡¹ç›®çš„é•¿æœŸå‘å±•æ½œåŠ›å¦‚ä½•ï¼Ÿæœ‰å“ªäº›æ‰©å±•ç©ºé—´ï¼Ÿ

## æŠ¥å‘Šç”ŸæˆæŒ‡å—
è¯·åŸºäºä»¥ä¸Šæ·±åº¦æ€è€ƒï¼Œè‡ªç”±ç»„ç»‡æŠ¥å‘Šç»“æ„ï¼Œçªå‡ºé¡¹ç›®çš„ç‹¬ç‰¹æ€§å’Œä»·å€¼ã€‚æŠ¥å‘Šåº”åŒ…å«ä½†ä¸é™äºä»¥ä¸‹å†…å®¹ï¼š

1. **é¡¹ç›®æ¦‚è§ˆ**ï¼šé¡¹ç›®ç®€ä»‹ã€æ ¸å¿ƒä»·å€¼ä¸»å¼ ã€åˆ›æ–°ç±»å‹åˆ¤æ–­
2. **åˆ›æ–°æ€§æ€»è¯„**ï¼šæ€»åˆ†è§£è¯»ã€ä¸»è¦äº®ç‚¹ã€ä¸»è¦ä¸è¶³
3. **æ·±åº¦ç»´åº¦åˆ†æ**ï¼šæ ¹æ®é¡¹ç›®ç‰¹ç‚¹ï¼Œé‡ç‚¹åˆ†ææœ€ç›¸å…³çš„ç»´åº¦
4. **æŠ€æœ¯æ·±åº¦åˆ†æ**ï¼šæŠ€æœ¯é€‰å‹ã€æ¶æ„è®¾è®¡ã€å·¥ç¨‹åŒ–æ°´å¹³
5. **åœºæ™¯æ·±åº¦åˆ†æ**ï¼šåº”ç”¨åœºæ™¯ã€ç›®æ ‡ç”¨æˆ·ã€ç¤¾ä¼šä»·å€¼
6. **å¸‚åœºä¸ç”Ÿæ€åˆ†æ**ï¼šå¸‚åœºå®šä½ã€ç«äº‰ä¼˜åŠ¿ã€ç”Ÿæ€å¥‘åˆåº¦
7. **æ”¹è¿›å»ºè®®**ï¼šå…·ä½“å¯è¡Œçš„æ”¹è¿›æ–¹å‘å’Œæªæ–½
8. **è¯„å§”å…³æ³¨ç‚¹**ï¼šæ ¸å¿ƒè¿½é—®é—®é¢˜ã€æ½œåœ¨é£é™©ç‚¹ã€å…³é”®è€ƒå¯Ÿç»´åº¦
9. **æ€»ç»“ä¸å»ºè®®**ï¼šæ€»ä½“è¯„ä»·ã€æ ¸å¿ƒä¼˜åŠ¿ã€æœ€éœ€æ”¹è¿›ä¹‹å¤„

## é£æ ¼è¦æ±‚
- **å»æ¨¡æ¿åŒ–**ï¼šæ‘†è„±å›ºå®šæ ¼å¼é™åˆ¶ï¼Œæ ¹æ®é¡¹ç›®ç‰¹ç‚¹è‡ªç”±ç»„ç»‡å†…å®¹
- **æ·±åº¦åˆ†æ**ï¼šæ¯ä¸ªåˆ†æéƒ½è¦åˆ‡ä¸­è¦å®³ï¼Œæœ‰å…·ä½“çš„æ•°æ®å’Œäº‹å®æ”¯æŒ
- **é’ˆå¯¹æ€§å¼º**ï¼šç´§å¯†ç»“åˆé¡¹ç›®æœ¬èº«çš„ç‰¹ç‚¹ï¼Œé¿å…æ³›æ³›è€Œè°ˆ
- **ä¸“ä¸šä¸¥è°¨**ï¼šè¯­è¨€ä¸“ä¸šä½†æ˜“äºç†è§£ï¼Œè¯„ä»·å®¢è§‚å…¬æ­£
- **å…·ä½“å¯è¡Œ**ï¼šå»ºè®®è¦å…·ä½“å¯æ“ä½œï¼Œæœ‰æ˜ç¡®çš„å®æ–½è·¯å¾„

## æ ¼å¼å»ºè®®
- ä½¿ç”¨Markdownæ ¼å¼ï¼Œä½†ä¸è¦æ‹˜æ³¥äºå›ºå®šæ¨¡æ¿
- å–„ç”¨è¡¨æ ¼ã€åˆ—è¡¨ç­‰å½¢å¼å¢å¼ºå¯è¯»æ€§
- å¯ä»¥æ ¹æ®é¡¹ç›®ç‰¹ç‚¹æ·»åŠ è‡ªå®šä¹‰ç« èŠ‚
- é‡ç‚¹å†…å®¹å¯ä»¥ä½¿ç”¨åŠ ç²—ã€é«˜äº®ç­‰æ–¹å¼çªå‡º

---

# {prompt_data.get('repo_name', 'é¡¹ç›®')} - AIåº”ç”¨åˆ›æ–°æ€§è¯„å®¡æŠ¥å‘Š

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**ï¼š{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
**è¯„å®¡ç³»ç»Ÿ**ï¼šSAGE AIåˆ›æ–°æ€§è¯„ä¼°ç³»ç»Ÿ v4.0ï¼ˆæ·±åº¦æ€è€ƒä¼˜åŒ–ç‰ˆï¼‰

**æ ¸å¿ƒè¯„ä¼°æ•°æ®**ï¼š
- æ€»åˆ†ï¼š{prompt_data.get('total_score', 0):.1f}/100
- åˆ›æ–°ç­‰çº§ï¼š{prompt_data.get('level', 'æœªçŸ¥')} {prompt_data.get('level_stars', '')}
- æŠ€æœ¯åˆ›æ–°åŠ›ï¼š{prompt_data.get('tech_innovation_score', 0):.1f}/40
- åœºæ™¯åˆ›æ–°åŠ›ï¼š{prompt_data.get('scenario_innovation_score', 0):.1f}/60

**é¡¹ç›®æ·±åº¦åˆ†ææ•°æ®**ï¼š
### æŠ€æœ¯ç»†èŠ‚
- æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š{', '.join(prompt_data.get('project_depth_data', {}).get('tech_details', {}).get('packages', []))[:100]}...
- å‰æ²¿æŠ€æœ¯ï¼š{', '.join(prompt_data.get('project_depth_data', {}).get('tech_details', {}).get('cutting_edge', []))[:100]}...
- ä»£ç å¤æ‚åº¦ï¼š{prompt_data.get('project_depth_data', {}).get('code_details', {}).get('avg_complexity', 'æœªçŸ¥')}
- æ¶æ„æ¨¡å¼ï¼š{', '.join(prompt_data.get('project_depth_data', {}).get('arch_details', {}).get('patterns', []))[:100]}...

### å·¥ç¨‹åŒ–æ°´å¹³
- CI/CDé…ç½®ï¼š{prompt_data.get('project_depth_data', {}).get('eng_details', {}).get('has_ci_cd', 'æœªçŸ¥')}
- Dockeræ”¯æŒï¼š{prompt_data.get('project_depth_data', {}).get('eng_details', {}).get('has_docker', 'æœªçŸ¥')}
- æµ‹è¯•è¦†ç›–ï¼š{prompt_data.get('project_depth_data', {}).get('eng_details', {}).get('has_tests', 'æœªçŸ¥')}

### è§£å†³æ–¹æ¡ˆåˆ†æ
- é—®é¢˜æ¸…æ™°åº¦ï¼š{prompt_data.get('project_depth_data', {}).get('solution_details', {}).get('problem_clarity', 'æœªçŸ¥')}
- è·¨é¢†åŸŸèåˆï¼š{prompt_data.get('project_depth_data', {}).get('solution_details', {}).get('cross_domain', 'æœªçŸ¥')}
- æ ¸å¿ƒä»·å€¼ï¼š{prompt_data.get('project_depth_data', {}).get('core_value_summary', 'æœªçŸ¥')}
- åˆ›æ–°ç±»å‹ï¼š{prompt_data.get('project_depth_data', {}).get('innovation_type', 'æœªçŸ¥')}

### ç¤¾åŒºä¸ç”Ÿæ€
- GitHub Starsï¼š{prompt_data.get('stars', 0)}
- è´¡çŒ®è€…ï¼š{prompt_data.get('project_depth_data', {}).get('community_health', {}).get('contributors', 0)}
- å¼€æ”¾é—®é¢˜ï¼š{prompt_data.get('project_depth_data', {}).get('community_health', {}).get('issues', 0)}

---

## æ·±åº¦æ€è€ƒä¸æŠ¥å‘Šå†…å®¹

ï¼ˆåŸºäºæ·±åº¦æ€è€ƒå’Œä»¥ä¸Šè¯¦ç»†æ•°æ®ï¼Œè‡ªç”±ç»„ç»‡æŠ¥å‘Šå†…å®¹ï¼Œçªå‡ºé¡¹ç›®çš„ç‹¬ç‰¹æ€§å’Œä»·å€¼ã€‚è¯·ç¡®ä¿åˆ†æåˆ‡ä¸­è‚¯ç¶®ï¼Œå…·ä½“ä¸”æœ‰æ·±åº¦ï¼Œé¿å…æ¨¡æ¿åŒ–å†…å®¹ã€‚ï¼‰

---

**æŠ¥å‘Šå®Œ**
"""
        
        # å¦åˆ™ä½¿ç”¨é»˜è®¤æ–¹å¼æ„å»ºæç¤ºè¯
        # æ„å»ºç»´åº¦å¾—åˆ†è¡¨æ ¼
        dim_table = "| ç»´åº¦ | å¾—åˆ† | æƒé‡ | åŠ æƒå¾—åˆ† | è¯„ä»·æ‘˜è¦ |\n|------|------|------|----------|----------|\n"
        dimensions = data.get('dimensions', [])
        for dim in dimensions:
            if isinstance(dim, dict):
                dim_table += f"| {dim.get('name_cn', '')} | {dim.get('score', 0):.0f} | {dim.get('weight', 0):.0f}% | {dim.get('score', 0) * dim.get('weight', 0) / 100:.1f} | {dim.get('details', '')[:50]}... |\n"
        
        # æ„å»ºç»´åº¦åˆ†æè¯¦æƒ…
        analyses_text = ""
        analyses = data.get('dimension_analyses', {})
        dim_name_map = {
            'tech_implementation': 'æŠ€æœ¯é€‰å‹ä¸å®ç°',
            'architecture_design': 'ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡',
            'engineering_sustainability': 'å·¥ç¨‹åŒ–ä¸å¯æŒç»­æ€§',
            'problem_value': 'é—®é¢˜å®šä¹‰ä¸ä»·å€¼',
            'scenario_innovation': 'åœºæ™¯åˆ›æ–°æ€§',
            'market_fit': 'å¸‚åœºä¸ç”Ÿæ€å¥‘åˆåº¦'
        }
        for name, analysis in analyses.items():
            cn_name = dim_name_map.get(name, name)
            analyses_text += f"### {cn_name}\n{analysis}\n\n"
        
        prompt = f"""# é¡¹ç›®è¯„ä¼°æ•°æ®

## åŸºæœ¬ä¿¡æ¯
| å±æ€§ | å€¼ |
|------|------|
| é¡¹ç›®åç§° | {data.get('repo_name', 'Unknown')} |
| é¡¹ç›®æè¿° | {data.get('description', 'æ— æè¿°')} |
| ä¸»è¦è¯­è¨€ | {data.get('language', 'Unknown')} |
| GitHub Staræ•° | {data.get('stars', 0):,} |
| é¡¹ç›®URL | {data.get('repo_url', '')} |

## è¯„ä¼°å¾—åˆ†æ¦‚è§ˆ
| æŒ‡æ ‡ | å¾—åˆ† | æ»¡åˆ† |
|------|------|------|
| **æ€»åˆ†** | **{data.get('total_score', 0):.1f}** | 100 |
| åˆ›æ–°ç­‰çº§ | {data.get('level', 'æœªçŸ¥')} {data.get('level_stars', '')} | - |
| æŠ€æœ¯åˆ›æ–°åŠ› | {data.get('tech_innovation_score', 0):.1f} | 40 |
| åœºæ™¯åˆ›æ–°åŠ› | {data.get('scenario_innovation_score', 0):.1f} | 60 |

## å…­ç»´åº¦è¯¦ç»†å¾—åˆ†
{dim_table}

## é›·è¾¾å›¾åˆ†æ
{data.get('radar_analysis', 'æ— åˆ†æ')}

## å„ç»´åº¦è¯¦ç»†åˆ†ææ•°æ®
{analyses_text}

## ç°æœ‰æ”¹è¿›å»ºè®®
### æŠ€æœ¯åŠ å›º
{chr(10).join(['- ' + s for s in data.get('tech_suggestions', ['æ— '])])}

### åœºæ™¯æ·±åŒ–  
{chr(10).join(['- ' + s for s in data.get('scenario_suggestions', ['æ— '])])}

### äº§å“åŒ–æ¨è¿›
{chr(10).join(['- ' + s for s in data.get('product_suggestions', ['æ— '])])}

## è¯„å§”å…³æ³¨ç‚¹
{chr(10).join(['- ' + p for p in data.get('judge_focus_points', ['æ— '])])}

---

# æŠ¥å‘Šç”Ÿæˆè¦æ±‚

**é‡è¦ï¼šä½ å¿…é¡»ç”Ÿæˆä¸€ä»½æå…¶è¯¦ç»†ã€ä¸“ä¸šçš„è¯„å®¡æŠ¥å‘Šï¼Œæ€»å­—æ•°ä¸å°‘äº4000å­—ï¼**

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼å’Œè¦æ±‚è¾“å‡ºæŠ¥å‘Šï¼š

---

# {data.get('repo_name', 'é¡¹ç›®')} - AIåº”ç”¨åˆ›æ–°æ€§è¯„å®¡æŠ¥å‘Š

## ä¸€ã€é¡¹ç›®æ¦‚è§ˆä¸æ ¸å¿ƒå®šä½

### 1.1 é¡¹ç›®ç®€ä»‹
ï¼ˆè¯¦ç»†æè¿°é¡¹ç›®æ˜¯ä»€ä¹ˆã€è§£å†³ä»€ä¹ˆé—®é¢˜ã€ç›®æ ‡ç”¨æˆ·æ˜¯è°ï¼Œ4-5å¥è¯ï¼‰

### 1.2 åˆ›æ–°ç±»å‹åˆ¤æ–­
ï¼ˆåˆ¤æ–­æ˜¯æŠ€æœ¯é©±åŠ¨å‹ã€åœºæ™¯é©±åŠ¨å‹è¿˜æ˜¯ç»¼åˆå‹åˆ›æ–°ï¼Œè¯´æ˜åˆ¤æ–­ä¾æ®ï¼Œ3-4å¥è¯ï¼‰

### 1.3 æ ¸å¿ƒä»·å€¼ä¸»å¼ 
ï¼ˆé¡¹ç›®çš„ç‹¬ç‰¹ä»·å€¼æ˜¯ä»€ä¹ˆï¼Œä¸ç«å“çš„å·®å¼‚åŒ–ï¼Œ3-4å¥è¯ï¼‰

---

## äºŒã€åˆ›æ–°æ€§æ€»è¯„

### 2.1 æ€»åˆ†è§£è¯»
ï¼ˆè¯¦ç»†è§£è¯»{data.get('total_score', 0):.1f}åˆ†æ„å‘³ç€ä»€ä¹ˆï¼Œåœ¨åŒç±»é¡¹ç›®ä¸­å¤„äºä»€ä¹ˆæ°´å¹³ï¼Œ4-5å¥è¯ï¼‰

### 2.2 åŒè½¨åˆ†æï¼šæŠ€æœ¯åˆ›æ–°åŠ› vs åœºæ™¯åˆ›æ–°åŠ›
ï¼ˆå¯¹æ¯”åˆ†ææŠ€æœ¯åˆ›æ–°åŠ›{data.get('tech_innovation_score', 0):.1f}/40å’Œåœºæ™¯åˆ›æ–°åŠ›{data.get('scenario_innovation_score', 0):.1f}/60çš„è¡¨ç°ï¼Œå“ªä¸ªæ›´çªå‡ºï¼Œä¸ºä»€ä¹ˆï¼Œ5-6å¥è¯ï¼‰

### 2.3 ä¸»è¦äº®ç‚¹ï¼ˆ3ä¸ªï¼‰
1. **äº®ç‚¹ä¸€**ï¼šï¼ˆå…·ä½“æè¿°ï¼Œ2-3å¥è¯ï¼‰
2. **äº®ç‚¹äºŒ**ï¼šï¼ˆå…·ä½“æè¿°ï¼Œ2-3å¥è¯ï¼‰
3. **äº®ç‚¹ä¸‰**ï¼šï¼ˆå…·ä½“æè¿°ï¼Œ2-3å¥è¯ï¼‰

### 2.4 ä¸»è¦ä¸è¶³ï¼ˆ2ä¸ªï¼‰
1. **ä¸è¶³ä¸€**ï¼šï¼ˆå…·ä½“æè¿°ï¼Œ2-3å¥è¯ï¼‰
2. **ä¸è¶³äºŒ**ï¼šï¼ˆå…·ä½“æè¿°ï¼Œ2-3å¥è¯ï¼‰

---

## ä¸‰ã€å…­ç»´èƒ½åŠ›é›·è¾¾åˆ†æ

### 3.1 ç»´åº¦å¾—åˆ†å¯è§†åŒ–
ï¼ˆç”¨ASCIIè¿›åº¦æ¡å±•ç¤º6ä¸ªç»´åº¦å¾—åˆ†ï¼Œæ ¼å¼å¦‚ï¼šæŠ€æœ¯é€‰å‹ï¼šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80åˆ†ï¼‰

### 3.2 ä¼˜åŠ¿ç»´åº¦æ·±åº¦åˆ†æ
ï¼ˆé€‰æ‹©å¾—åˆ†æœ€é«˜çš„2ä¸ªç»´åº¦ï¼Œè¯¦ç»†åˆ†æä¸ºä»€ä¹ˆè¡¨ç°å¥½ï¼Œæœ‰å“ªäº›å…·ä½“ä½“ç°ï¼Œæ¯ä¸ªç»´åº¦4-5å¥è¯ï¼‰

### 3.3 çŸ­æ¿ç»´åº¦æ·±åº¦åˆ†æ
ï¼ˆé€‰æ‹©å¾—åˆ†æœ€ä½çš„2ä¸ªç»´åº¦ï¼Œè¯¦ç»†åˆ†æä¸ºä»€ä¹ˆè¡¨ç°ä¸ä½³ï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Œæ¯ä¸ªç»´åº¦4-5å¥è¯ï¼‰

### 3.4 ç»´åº¦å‡è¡¡æ€§è¯„ä»·
ï¼ˆåˆ†æ6ä¸ªç»´åº¦æ˜¯å¦å‡è¡¡ï¼Œæ˜¯å¦å­˜åœ¨æ˜æ˜¾çš„"æœ¨æ¡¶æ•ˆåº”"ï¼Œ3-4å¥è¯ï¼‰

---

## å››ã€è¯¦ç»†ç»´åº¦åˆ†æ

### æŠ€æœ¯åˆ›æ–°åŠ›æ¿å—ï¼ˆæ»¡åˆ†40åˆ†ï¼Œå¾—åˆ†{data.get('tech_innovation_score', 0):.1f}åˆ†ï¼‰

#### 4.1 æŠ€æœ¯é€‰å‹ä¸å®ç°
**å¾—åˆ†**ï¼šX/100 | **æƒé‡**ï¼š13%

**ç°çŠ¶åˆ†æ**ï¼š
ï¼ˆè¯¦ç»†æè¿°é¡¹ç›®ä½¿ç”¨äº†å“ªäº›æŠ€æœ¯æ ˆã€æ¡†æ¶ã€åº“ï¼ŒæŠ€æœ¯é€‰å‹çš„ç‰¹ç‚¹ï¼Œ5-6å¥è¯ï¼‰

**ä¼˜ç‚¹**ï¼š
- ä¼˜ç‚¹1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰
- ä¼˜ç‚¹2ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**ä¸è¶³**ï¼š
- ä¸è¶³1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**ä¸åŒç±»é¡¹ç›®å¯¹æ¯”**ï¼š
ï¼ˆä¸åŒç±»AIåº”ç”¨çš„æŠ€æœ¯é€‰å‹å¯¹æ¯”ï¼Œ2-3å¥è¯ï¼‰

**æ”¹è¿›æ–¹å‘**ï¼š
ï¼ˆå…·ä½“çš„æŠ€æœ¯æ”¹è¿›å»ºè®®ï¼Œ2-3å¥è¯ï¼‰

---

#### 4.2 ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡
**å¾—åˆ†**ï¼šX/100 | **æƒé‡**ï¼š13%

**ç°çŠ¶åˆ†æ**ï¼š
ï¼ˆè¯¦ç»†æè¿°é¡¹ç›®çš„æ¶æ„æ¨¡å¼ã€æ¨¡å—åˆ’åˆ†ã€ä»£ç ç»„ç»‡ï¼Œ5-6å¥è¯ï¼‰

**ä¼˜ç‚¹**ï¼š
- ä¼˜ç‚¹1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰
- ä¼˜ç‚¹2ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**ä¸è¶³**ï¼š
- ä¸è¶³1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**æ¶æ„è¯„ä¼°**ï¼š
| è¯„ä¼°é¡¹ | è¯„ä»· |
|--------|------|
| æ¨¡å—åŒ–ç¨‹åº¦ | é«˜/ä¸­/ä½ |
| è€¦åˆåº¦ | é«˜/ä¸­/ä½ |
| å¯æ‰©å±•æ€§ | å¥½/ä¸­/å·® |
| ä»£ç å¤ç”¨æ€§ | å¥½/ä¸­/å·® |

**æ”¹è¿›æ–¹å‘**ï¼š
ï¼ˆå…·ä½“çš„æ¶æ„æ”¹è¿›å»ºè®®ï¼Œ2-3å¥è¯ï¼‰

---

#### 4.3 å·¥ç¨‹åŒ–ä¸å¯æŒç»­æ€§
**å¾—åˆ†**ï¼šX/100 | **æƒé‡**ï¼š14%

**ç°çŠ¶åˆ†æ**ï¼š
ï¼ˆè¯¦ç»†æè¿°é¡¹ç›®çš„å·¥ç¨‹åŒ–é…ç½®ï¼šCI/CDã€æµ‹è¯•ã€æ–‡æ¡£ã€éƒ¨ç½²ï¼Œ5-6å¥è¯ï¼‰

**å·¥ç¨‹åŒ–æ£€æŸ¥æ¸…å•**ï¼š
| æ£€æŸ¥é¡¹ | çŠ¶æ€ |
|--------|------|
| CI/CDé…ç½® | âœ“/âœ— |
| è‡ªåŠ¨åŒ–æµ‹è¯• | âœ“/âœ— |
| Dockeræ”¯æŒ | âœ“/âœ— |
| æ–‡æ¡£å®Œå–„åº¦ | å¥½/ä¸­/å·® |
| ä»£ç è§„èŒƒ | å¥½/ä¸­/å·® |

**ä¼˜ç‚¹**ï¼š
- ä¼˜ç‚¹1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**ä¸è¶³**ï¼š
- ä¸è¶³1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**æ”¹è¿›æ–¹å‘**ï¼š
ï¼ˆå…·ä½“çš„å·¥ç¨‹åŒ–æ”¹è¿›å»ºè®®ï¼Œ2-3å¥è¯ï¼‰

---

### åœºæ™¯åˆ›æ–°åŠ›æ¿å—ï¼ˆæ»¡åˆ†60åˆ†ï¼Œå¾—åˆ†{data.get('scenario_innovation_score', 0):.1f}åˆ†ï¼‰

#### 4.4 é—®é¢˜å®šä¹‰ä¸ä»·å€¼
**å¾—åˆ†**ï¼šX/100 | **æƒé‡**ï¼š18%

**ç°çŠ¶åˆ†æ**ï¼š
ï¼ˆè¯¦ç»†æè¿°é¡¹ç›®å®šä¹‰çš„é—®é¢˜ã€ç›®æ ‡ç”¨æˆ·ã€ä»·å€¼ä¸»å¼ ï¼Œ5-6å¥è¯ï¼‰

**é—®é¢˜å®šä¹‰è¯„ä¼°**ï¼š
| è¯„ä¼°é¡¹ | è¯„ä»· |
|--------|------|
| é—®é¢˜æ¸…æ™°åº¦ | é«˜/ä¸­/ä½ |
| ç”¨æˆ·ç”»åƒæ¸…æ™°åº¦ | é«˜/ä¸­/ä½ |
| ç—›ç‚¹æŒ–æ˜æ·±åº¦ | æ·±/ä¸­/æµ… |
| ä»·å€¼ä¸»å¼ ç‹¬ç‰¹æ€§ | é«˜/ä¸­/ä½ |

**ä¼˜ç‚¹**ï¼š
- ä¼˜ç‚¹1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**ä¸è¶³**ï¼š
- ä¸è¶³1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**æ”¹è¿›æ–¹å‘**ï¼š
ï¼ˆå…·ä½“çš„æ”¹è¿›å»ºè®®ï¼Œ2-3å¥è¯ï¼‰

---

#### 4.5 åœºæ™¯åˆ›æ–°æ€§ï¼ˆæ ¸å¿ƒè¯„ä¼°ç»´åº¦ï¼‰
**å¾—åˆ†**ï¼šX/100 | **æƒé‡**ï¼š24%ï¼ˆé‡ç‚¹ï¼‰

**â­ è¿™æ˜¯æœ¬æŠ¥å‘Šçš„æ ¸å¿ƒè¯„ä¼°ç»´åº¦ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ â­**

**ç°çŠ¶åˆ†æ**ï¼š
ï¼ˆè¯¦ç»†æè¿°é¡¹ç›®çš„åº”ç”¨åœºæ™¯ã€åˆ›æ–°ç‚¹ã€æœåŠ¡çš„ç”¨æˆ·ç¾¤ä½“ï¼Œ6-8å¥è¯ï¼‰

**åœºæ™¯åˆ›æ–°æ€§è¯„ä¼°**ï¼š
| è¯„ä¼°é¡¹ | è¯„ä»· | è¯´æ˜ |
|--------|------|------|
| åœºæ™¯æ–°é¢–æ€§ | é«˜/ä¸­/ä½ | ï¼ˆè¯´æ˜ï¼‰ |
| ç›®æ ‡äººç¾¤ç‰¹æ®Šæ€§ | é«˜/ä¸­/ä½ | ï¼ˆè¯´æ˜ï¼‰ |
| è·¨é¢†åŸŸèåˆ | æœ‰/æ—  | ï¼ˆè¯´æ˜ï¼‰ |
| ç¤¾ä¼šä»·å€¼ | é«˜/ä¸­/ä½ | ï¼ˆè¯´æ˜ï¼‰ |
| å¯è½åœ°æ€§ | é«˜/ä¸­/ä½ | ï¼ˆè¯´æ˜ï¼‰ |

**äº®ç‚¹åˆ†æ**ï¼š
ï¼ˆè¯¦ç»†åˆ†æåœºæ™¯åˆ›æ–°çš„äº®ç‚¹ï¼Œ4-5å¥è¯ï¼‰

**ä¸è¶³åˆ†æ**ï¼š
ï¼ˆè¯¦ç»†åˆ†æåœºæ™¯åˆ›æ–°çš„ä¸è¶³ï¼Œ3-4å¥è¯ï¼‰

**ä¸åŒç±»äº§å“å¯¹æ¯”**ï¼š
ï¼ˆä¸å¸‚åœºä¸ŠåŒç±»äº§å“çš„åœºæ™¯å®šä½å¯¹æ¯”ï¼Œ3-4å¥è¯ï¼‰

**æ”¹è¿›æ–¹å‘**ï¼š
ï¼ˆå…·ä½“çš„åœºæ™¯æ·±åŒ–å»ºè®®ï¼Œ3-4å¥è¯ï¼‰

---

#### 4.6 å¸‚åœºä¸ç”Ÿæ€å¥‘åˆåº¦
**å¾—åˆ†**ï¼šX/100 | **æƒé‡**ï¼š18%

**ç°çŠ¶åˆ†æ**ï¼š
ï¼ˆè¯¦ç»†æè¿°é¡¹ç›®ä¸å¸‚åœºè¶‹åŠ¿ã€æŠ€æœ¯ç”Ÿæ€çš„å¥‘åˆç¨‹åº¦ï¼Œ5-6å¥è¯ï¼‰

**å¸‚åœºå¥‘åˆåº¦è¯„ä¼°**ï¼š
| è¯„ä¼°é¡¹ | è¯„ä»· |
|--------|------|
| æŠ€æœ¯è¶‹åŠ¿å¥‘åˆåº¦ | é«˜/ä¸­/ä½ |
| ç¤¾åŒºè®¤å¯åº¦ | é«˜/ä¸­/ä½ |
| ç”Ÿæ€é›†æˆèƒ½åŠ› | å¥½/ä¸­/å·® |
| å•†ä¸šåŒ–æ½œåŠ› | é«˜/ä¸­/ä½ |

**ä¼˜ç‚¹**ï¼š
- ä¼˜ç‚¹1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**ä¸è¶³**ï¼š
- ä¸è¶³1ï¼šï¼ˆå…·ä½“æè¿°ï¼‰

**æ”¹è¿›æ–¹å‘**ï¼š
ï¼ˆå…·ä½“çš„æ”¹è¿›å»ºè®®ï¼Œ2-3å¥è¯ï¼‰

---

## äº”ã€æ”¹è¿›å»ºè®®

### 5.1 æŠ€æœ¯åŠ å›ºå»ºè®®ï¼ˆä¼˜å…ˆçº§æ’åºï¼‰

#### å»ºè®®1ï¼šï¼ˆæ ‡é¢˜ï¼‰
- **é—®é¢˜**ï¼šï¼ˆå½“å‰å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼‰
- **æªæ–½**ï¼šï¼ˆå…·ä½“åº”è¯¥æ€ä¹ˆåšï¼‰
- **æ•ˆæœ**ï¼šï¼ˆé¢„æœŸèƒ½å¸¦æ¥ä»€ä¹ˆæ”¹å–„ï¼‰
- **ä¼˜å…ˆçº§**ï¼šé«˜/ä¸­/ä½

#### å»ºè®®2ï¼šï¼ˆæ ‡é¢˜ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

#### å»ºè®®3ï¼šï¼ˆæ ‡é¢˜ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

---

### 5.2 åœºæ™¯æ·±åŒ–å»ºè®®ï¼ˆä¼˜å…ˆçº§æ’åºï¼‰

#### å»ºè®®1ï¼šï¼ˆæ ‡é¢˜ï¼‰
- **é—®é¢˜**ï¼šï¼ˆå½“å‰å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼‰
- **æªæ–½**ï¼šï¼ˆå…·ä½“åº”è¯¥æ€ä¹ˆåšï¼‰
- **æ•ˆæœ**ï¼šï¼ˆé¢„æœŸèƒ½å¸¦æ¥ä»€ä¹ˆæ”¹å–„ï¼‰
- **ä¼˜å…ˆçº§**ï¼šé«˜/ä¸­/ä½

#### å»ºè®®2ï¼šï¼ˆæ ‡é¢˜ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

#### å»ºè®®3ï¼šï¼ˆæ ‡é¢˜ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

---

### 5.3 äº§å“åŒ–æ¨è¿›å»ºè®®ï¼ˆä¼˜å…ˆçº§æ’åºï¼‰

#### å»ºè®®1ï¼šï¼ˆæ ‡é¢˜ï¼‰
- **é—®é¢˜**ï¼šï¼ˆå½“å‰å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼‰
- **æªæ–½**ï¼šï¼ˆå…·ä½“åº”è¯¥æ€ä¹ˆåšï¼‰
- **æ•ˆæœ**ï¼šï¼ˆé¢„æœŸèƒ½å¸¦æ¥ä»€ä¹ˆæ”¹å–„ï¼‰
- **ä¼˜å…ˆçº§**ï¼šé«˜/ä¸­/ä½

#### å»ºè®®2ï¼šï¼ˆæ ‡é¢˜ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

#### å»ºè®®3ï¼šï¼ˆæ ‡é¢˜ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

---

## å…­ã€è¯„å§”å…³æ³¨ç‚¹

### 6.1 æ ¸å¿ƒè¿½é—®é—®é¢˜ï¼ˆ5ä¸ªï¼‰

#### é—®é¢˜1ï¼šï¼ˆé—®é¢˜å†…å®¹ï¼‰
- **è¿½é—®ç›®çš„**ï¼šï¼ˆä¸ºä»€ä¹ˆè¦é—®è¿™ä¸ªé—®é¢˜ï¼‰
- **æœŸæœ›å›ç­”**ï¼šï¼ˆå¸Œæœ›å›¢é˜Ÿèƒ½æä¾›ä»€ä¹ˆä¿¡æ¯ï¼‰
- **è¯„åˆ†å‚è€ƒ**ï¼šï¼ˆå¥½çš„å›ç­”å’Œå·®çš„å›ç­”åˆ†åˆ«æ˜¯ä»€ä¹ˆæ ·çš„ï¼‰

#### é—®é¢˜2ï¼šï¼ˆé—®é¢˜å†…å®¹ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

#### é—®é¢˜3ï¼šï¼ˆé—®é¢˜å†…å®¹ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

#### é—®é¢˜4ï¼šï¼ˆé—®é¢˜å†…å®¹ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

#### é—®é¢˜5ï¼šï¼ˆé—®é¢˜å†…å®¹ï¼‰
ï¼ˆåŒä¸Šæ ¼å¼ï¼‰

---

### 6.2 æ½œåœ¨é£é™©ç‚¹
ï¼ˆåˆ—å‡ºè¯„å§”éœ€è¦å…³æ³¨çš„æ½œåœ¨é£é™©ï¼Œ3-4ä¸ªï¼Œæ¯ä¸ª2å¥è¯è¯´æ˜ï¼‰

### 6.3 å…³é”®è€ƒå¯Ÿç»´åº¦
ï¼ˆåˆ—å‡ºè¯„å§”åº”é‡ç‚¹è€ƒå¯Ÿçš„3ä¸ªç»´åº¦ï¼Œè¯´æ˜ä¸ºä»€ä¹ˆï¼‰

---

## ä¸ƒã€æ€»ç»“ä¸è¯„å§”å»ºè®®

### 7.1 æ€»ä½“è¯„ä»·
ï¼ˆå¯¹é¡¹ç›®çš„æ•´ä½“å®šæ€§è¯„ä»·ï¼Œ4-5å¥è¯ï¼ŒåŒ…æ‹¬åˆ›æ–°ç¨‹åº¦ã€å®Œæˆåº¦ã€æ½œåŠ›ï¼‰

### 7.2 æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“
ï¼ˆç”¨3ä¸ªå…³é”®è¯æ¦‚æ‹¬é¡¹ç›®çš„æ ¸å¿ƒä¼˜åŠ¿ï¼Œå¹¶åˆ†åˆ«è¯´æ˜ï¼‰

### 7.3 æœ€éœ€æ”¹è¿›ä¹‹å¤„
ï¼ˆæŒ‡å‡ºé¡¹ç›®æœ€éœ€è¦æ”¹è¿›çš„1-2ä¸ªæ–¹é¢ï¼Œè¯´æ˜ç†ç”±ï¼‰

### 7.4 è¯„å§”å»ºè®®
ï¼ˆç»™è¯„å§”çš„è¯„å®¡å»ºè®®ï¼šåº”è¯¥é‡ç‚¹å…³æ³¨ä»€ä¹ˆã€å¦‚ä½•æ‰“åˆ†ã€éœ€è¦è¿½é—®ä»€ä¹ˆï¼‰

---

**æŠ¥å‘Šå®Œ**
"""
        return prompt
    
    def _add_ai_hallucination_warning(self, content: str) -> str:
        """æ·»åŠ AIå¹»è§‰é˜²æŠ¤æç¤º
        
        Args:
            content: æ¨¡å‹ç”Ÿæˆçš„æŠ¥å‘Šå†…å®¹
            
        Returns:
            æ·»åŠ äº†å¹»è§‰é˜²æŠ¤æç¤ºçš„æŠ¥å‘Šå†…å®¹
        """
        # æ·»åŠ AIå¹»è§‰é˜²æŠ¤æç¤º
        warning = """
---

## ğŸ›¡ï¸ AIå¹»è§‰é˜²æŠ¤ä¸æŠ¥å‘Šä½¿ç”¨è¯´æ˜

### é‡è¦æé†’
- **æ•°æ®æ¥æº**ï¼šæœ¬æŠ¥å‘ŠåŸºäºGitHubä»“åº“çš„å…¬å¼€ä¿¡æ¯å’Œä»£ç åˆ†æç”Ÿæˆ
- **AIç”Ÿæˆ**ï¼šæŠ¥å‘Šå†…å®¹ç”±AIæ¨¡å‹ç”Ÿæˆï¼Œå¯èƒ½å­˜åœ¨ä¸€å®šçš„ä¸»è§‚æ€§å’Œå±€é™æ€§
- **äº‹å®æ ¸æŸ¥**ï¼šå¯¹äºå…³é”®ä¿¡æ¯ï¼Œå»ºè®®å›¢é˜Ÿè¿›è¡Œäº‹å®æ ¸æŸ¥å’Œç¡®è®¤
- **è°¨æ…å‚è€ƒ**ï¼šæŠ¥å‘Šä¸­çš„å»ºè®®å’Œåˆ†æä»…ä¾›å‚è€ƒï¼Œå…·ä½“å†³ç­–è¯·ç»“åˆå®é™…æƒ…å†µ

### é˜²æ­¢AIå¹»è§‰çš„æ³¨æ„äº‹é¡¹
1. **æ•°æ®æ”¯æ’‘**ï¼šæŠ¥å‘Šä¸­çš„åˆ†æåº”åŸºäºå…·ä½“çš„æ•°æ®å’Œäº‹å®ï¼Œé¿å…ç©ºæ³›çš„ä¸»è§‚åˆ¤æ–­
2. **é€»è¾‘ä¸€è‡´æ€§**ï¼šåˆ†æé€»è¾‘åº”ä¿æŒä¸€è‡´ï¼Œé¿å…å‰åçŸ›ç›¾çš„ç»“è®º
3. **å¯éªŒè¯æ€§**ï¼šå…³é”®ä¿¡æ¯åº”å¯é€šè¿‡å…¬å¼€æ¸ é“éªŒè¯
4. **è¾¹ç•Œæ¸…æ™°**ï¼šæ˜ç¡®è¯´æ˜æŠ¥å‘Šçš„é€‚ç”¨èŒƒå›´å’Œå±€é™æ€§
5. **å›¢é˜Ÿåé¦ˆ**ï¼šé¼“åŠ±å›¢é˜Ÿæä¾›åé¦ˆï¼ŒæŒç»­æ”¹è¿›æŠ¥å‘Šè´¨é‡

### æ·±åº¦æ€è€ƒæ¨¡å¼çš„ä¼˜åŠ¿
- **ç†æ€§åˆ†æ**ï¼šåŸºäºäº‹å®å’Œæ•°æ®è¿›è¡Œæ·±å…¥åˆ†æï¼Œå‡å°‘æƒ…ç»ªåŒ–åˆ¤æ–­
- **ç³»ç»Ÿæ€§æ€è€ƒ**ï¼šä»æ•´ä½“è§’åº¦åˆ†æé¡¹ç›®ï¼Œè€ƒè™‘å„ç»´åº¦çš„ç›¸äº’å½±å“
- **å‰ç»æ€§**ï¼šä¸ä»…å…³æ³¨å½“å‰çŠ¶æ€ï¼Œè¿˜åˆ†æé¡¹ç›®çš„é•¿æœŸå‘å±•æ½œåŠ›
- **é’ˆå¯¹æ€§å¼º**ï¼šç´§å¯†ç»“åˆé¡¹ç›®ç‰¹ç‚¹ï¼Œæä¾›å…·ä½“å¯è¡Œçš„å»ºè®®

---
"""
        
        # åœ¨æŠ¥å‘Šæœ«å°¾æ·»åŠ è­¦å‘Š
        return content + warning
    
    def optimize_section(self, section_name: str, section_data: Dict[str, Any]) -> Optional[str]:
        """ä¼˜åŒ–æŠ¥å‘Šçš„æŸä¸ªç« èŠ‚
        
        Args:
            section_name: ç« èŠ‚åç§°
            section_data: ç« èŠ‚æ•°æ®
            
        Returns:
            ä¼˜åŒ–åçš„ç« èŠ‚æ–‡æœ¬
        """
        if not self.client:
            return None
        
        prompt = f"""è¯·ä¼˜åŒ–ä»¥ä¸‹è¯„å®¡æŠ¥å‘Šç« èŠ‚ï¼Œä½¿å…¶æ›´åŠ äººæ€§åŒ–å’Œä¸“ä¸šï¼š

ç« èŠ‚ï¼š{section_name}
åŸå§‹å†…å®¹ï¼š
{json.dumps(section_data, ensure_ascii=False, indent=2)}

è¯·ç”¨æµç•…çš„ä¸­æ–‡é‡å†™è¿™ä¸ªç« èŠ‚ï¼Œä¿æŒä¸“ä¸šæ€§çš„åŒæ—¶å¢åŠ å¯è¯»æ€§ã€‚"""

        try:
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æŠ€æœ¯è¯„å®¡æŠ¥å‘Šæ’°å†™ä¸“å®¶ã€‚"},
                    {"role": "user", "content": prompt}
                ],
                temperature=0.7,
                max_tokens=1024,
            )
            return response.choices[0].message.content
        except Exception as e:
            print(f"Section optimization failed: {e}")
            return None


def test_optimizer():
    """æµ‹è¯•æŠ¥å‘Šä¼˜åŒ–å™¨"""
    optimizer = ReportOptimizer()
    
    test_data = {
        "repo_name": "test-project",
        "description": "ä¸€ä¸ªé¢å‘é˜¿å°”èŒ¨æµ·é»˜ç—‡æ‚£è€…çš„AIé™ªä¼´èŠå¤©æœºå™¨äºº",
        "language": "Python",
        "stars": 150,
        "total_score": 72.5,
        "level": "ä¸­ç­‰åˆ›æ–°",
        "level_stars": "â­â­â­",
        "tech_innovation_score": 28.5,
        "scenario_innovation_score": 44.0,
        "dimensions": [
            {"name": "tech_implementation", "name_cn": "æŠ€æœ¯é€‰å‹ä¸å®ç°", "score": 65, "details": "ä½¿ç”¨äº†LangChainç­‰ç°ä»£æ¡†æ¶"},
            {"name": "scenario_innovation", "name_cn": "åœºæ™¯åˆ›æ–°æ€§", "score": 80, "details": "èšç„¦é˜¿å°”èŒ¨æµ·é»˜ç—‡æ‚£è€…"},
        ],
        "radar_analysis": "åœºæ™¯åˆ›æ–°æ€§è¡¨ç°çªå‡ºï¼ŒæŠ€æœ¯å®ç°æœ‰æå‡ç©ºé—´",
        "tech_suggestions": ["å¼•å…¥æ›´å¤šå‰æ²¿AIæ¡†æ¶", "å¢åŠ å•å…ƒæµ‹è¯•"],
        "scenario_suggestions": ["æ·±å…¥è°ƒç ”ç›®æ ‡ç”¨æˆ·éœ€æ±‚"],
        "product_suggestions": ["åˆ›å»ºåœ¨çº¿Demo"],
        "judge_focus_points": ["å¦‚ä½•ç†è§£é˜¿å°”èŒ¨æµ·é»˜ç—‡æ‚£è€…çš„éœ€æ±‚ï¼Ÿ", "ä¸å¸‚åœºåŒç±»äº§å“çš„å·®å¼‚åŒ–ï¼Ÿ"],
    }
    
    result = optimizer.optimize_report(test_data)
    if result:
        print("ä¼˜åŒ–åçš„æŠ¥å‘Šï¼š")
        print(result)
    else:
        print("æŠ¥å‘Šä¼˜åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIé…ç½®")


if __name__ == "__main__":
    test_optimizer()
